{"chunk":2,"numChunks":7,"fileHash":"J5Ak0Ij4rhitK/uI7uWEFcPqQxN9VG6Mju20cl3spWY=","filePath":"pkg/litepay/provider_paypal.go","content":"package litepay\nfunc (c *paypal) Pay(cart Cart) (*Payment, error) {\n\tvar totalAmount float64\n\n\tcurrency := strings.ToUpper(cart.Currency)\n\tif !findInSlice(c.currency, strings.ToUpper(currency)) {\n\t\treturn nil, errors.New(\"this currency is not supported\")\n\t}\n\n\taccessToken, err := c.paypalAccessToken()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tfor _, s := range cart.Items {\n\t\ttotalAmount += float64(s.PriceData.UnitAmount) / 100 * float64(s.Quantity)\n\t}\n\n\torder := map[string]any{\n\t\t\"intent\": \"CAPTURE\",\n\t\t\"purchase_units\": []map[string]any{\n\t\t\t{\n\t\t\t\t\"amount\": map[string]any{\n\t\t\t\t\t\"currency_code\": currency,\n\t\t\t\t\t\"value\":         fmt.Sprintf(\"%.2f\", totalAmount),\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t\"payment_source\": map[string]any{\n\t\t\t\"paypal\": map[string]any{\n\t\t\t\t\"experience_context\": map[string]string{\n\t\t\t\t\t\"user_action\": \"PAY_NOW\",\n\t\t\t\t\t\"return_url\":  fmt.Sprintf(\"%s/?payment_system=%s&cart_id=%s\", c.successURL, c.paymentSystem, cart.ID),\n\t\t\t\t\t\"cancel_url\":  fmt.Sprintf(\"%s/?payment_system=%s&cart_id=%s\", c.cancelURL, c.paymentSystem, cart.ID),\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t}\n\n\torderJson, err := json.Marshal(order)"}