{"chunk":2,"numChunks":5,"fileHash":"WfR+2R/M3guhqnPA4GGm1f8tSMuQ0bWMN1w4XNQ6i+Q=","filePath":"internal/app.go","content":"package app\nfunc NewApp(httpAddr, httpsAddr string, noSite, appDev bool) error {\n\tctx, cancel := context.WithCancel(context.Background())\n\tdefer cancel()\n\n\tDevMode = appDev\n\tlog = logging.New()\n\n\tschema := \"http\"\n\tmainAddr := httpAddr\n\tif httpsAddr != \"\" {\n\t\tschema = \"https\"\n\t\tmainAddr = httpsAddr\n\t}\n\n\tif err := queries.New(migrations.Embed()); err != nil {\n\t\tlog.Err(err).Send()\n\t\treturn err\n\t}\n\n\t// web web server\n\tfiberConfig := fiber.Config{\n\t\t// Prefork:               true,\n\t\tDisableStartupMessage: true,\n\t\tBodyLimit:             50 * 1024 * 1024,\n\t}\n\tvar sitePath string\n\n\tif !noSite {\n\t\tsitePath = \"./site\"\n\t\tif DevMode {\n\t\t\tsitePath = \"../web/site\"\n\t\t} else {\n\t\t\tif !fsutil.IsDir(sitePath) || fsutil.IsEmptyDir(sitePath) {\n\t\t\t\tfsutil.EmbedExtract(web.EmbedSite(), \"\")\n\t\t\t}\n\t\t}\n\t\tviews := html.New(sitePath, \".html\")\n\t\tviews.Reload(true)\n\t\tviews.Delims(\"{#\", \"#}\")\n\t\tfiberConfig.Views = views\n\t}\n\n\tapp := fiber.New(fiberConfig)\n\tmiddleware.Fiber(app, log.Logger)"}