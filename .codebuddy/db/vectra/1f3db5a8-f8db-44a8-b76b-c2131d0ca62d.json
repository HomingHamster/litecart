{"chunk":4,"numChunks":7,"fileHash":"uGqTN4rV0zsU/GWluD0mH60Iqkfxyh88yA44W8jyI/4=","filePath":"internal/queries/cart.go","content":"package queries\nfunc (q *CartQueries) CartLetterPurchase(ctx context.Context, cartID string) (*models.MessageMail, error) {\n\t// Get cart data\n\temail, products, err := q.getCartData(ctx, cartID)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get cart data: %w\", err)\n\t}\n\n\t// Process digital content\n\tcontent, err := q.processDigitalContent(ctx, cartID, products)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to process digital content: %w\", err)\n\t}\n\n\t// Generate purchase email\n\treturn q.generatePurchaseEmail(ctx, email, content)\n}\nfunc (q *CartQueries) getCartData(ctx context.Context, cartID string) (string, []models.CartProduct, error) {\n\tvar (\n\t\temail    string\n\t\tcartJSON string\n\t)\n\n\terr := q.QueryRowContext(ctx, `\n        SELECT email, cart\n        FROM cart\n        WHERE payment_status = ? AND id = ?\n    `, litepay.PAID, cartID).Scan(&email, &cartJSON)\n\tif err != nil {\n\t\tif err == sql.ErrNoRows {\n\t\t\treturn \"\", nil, errors.ErrPageNotFound\n\t\t}\n\t\treturn \"\", nil, err\n\t}\n\n\tvar products []models.CartProduct\n\tif err := json.Unmarshal([]byte(cartJSON), &products); err != nil {\n\t\treturn \"\", nil, err\n\t}\n\n\treturn email, products, nil\n}"}