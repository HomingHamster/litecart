{"chunk":2,"numChunks":16,"fileHash":"OT1E1nCU/oF1uHBrV3/HQPWCZYVu1GcjnTiimB778ug=","filePath":"internal/queries/products.go","content":"package queries\nfunc (q *ProductQueries) ListProducts(ctx context.Context, private bool, idList ...models.CartProduct) (*models.Products, error) {\n\tcurrency, err := db.GetSettingByKey(ctx, \"currency\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tproducts := &models.Products{\n\t\tCurrency: currency[\"currency\"].Value.(string),\n\t}\n\n\tquery := `\n\t\t\tSELECT DISTINCT\n\t\t\t  product.id,\n\t\t\t\tproduct.name,\n\t\t\t\tproduct.brief,\n\t\t\t\tproduct.slug,\n\t\t\t\tproduct.amount,\n\t\t\t\tproduct.active,\n\t\t\t\tproduct.digital,\n\t\t\t\tEXISTS(SELECT 1 FROM digital_data WHERE digital_data.product_id = product.id AND digital_data.cart_id IS NULL) OR\n\t\t\t\tEXISTS(SELECT 1 FROM digital_file WHERE digital_file.product_id = product.id) AS digital_filled,\n\t\t\t\t(SELECT json_group_array(json_object('id', product_image.id, 'name', product_image.name, 'ext', product_image.ext)) as images FROM product_image WHERE product_id = product.id GROUP BY id LIMIT 1) as image,\n\t\t\t\tstrftime('%s', created)\n\t\t\tFROM product\n\t\t`\n\n\tqueryPublic := ` \n\t\t\tLEFT JOIN digital_data ON digital_data.product_id = product.id\n\t\t\tLEFT JOIN digital_file ON digital_file.product_id = product.id\n\t\t\tWHERE product.deleted = 0 AND product.active = 1\n\t\t`\n\n\tvar params []any\n\tvar queryAddon string\n\tif len(idList) > 0 {"}